<div class="auth-page">
  <div class="auth-container">
    <div class="auth-brand">
      <div class="brand-logo">
        <mat-icon class="logo-icon">school</mat-icon>
      </div>
      <h1 class="brand-title">Course Watcher</h1>
      <p class="brand-subtitle">Reset your password and get back to learning</p>
    </div>

    <mat-card class="auth-card">
      <mat-card-header class="auth-header">
        <mat-card-title class="auth-title">
          @if (!emailSent()) { Reset Password } @else { Check Your Email }
        </mat-card-title>
        <mat-card-subtitle class="auth-subtitle">
          @if (!emailSent()) { Enter your email address and we'll send you a
          reset link } @else { We've sent password reset instructions to your
          email }
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="auth-content">
        @if (errorMessage()) {
        <div class="auth-error-banner">
          <mat-icon>error_outline</mat-icon>
          <span>{{ errorMessage() }}</span>
        </div>
        } @if (emailSent()) {
        <div class="auth-success-banner">
          <mat-icon>check_circle_outline</mat-icon>
          <div class="success-content">
            <p><strong>Email sent successfully!</strong></p>
            <p>
              Please check your inbox and follow the instructions to reset your
              password.
            </p>
            <p class="email-note">
              Sent to: <strong>{{ sentToEmail() }}</strong>
            </p>
          </div>
        </div>

        <div class="success-actions">
          <button
            mat-raised-button
            color="primary"
            (click)="resendEmail()"
            [disabled]="isLoading()"
            class="auth-submit-btn"
            [class.loading]="isLoading()"
          >
            @if (isLoading()) {
            <mat-spinner diameter="20" class="spinner"></mat-spinner>
            Resending... } @else { Resend Email }
          </button>

          <div class="auth-links">
            <a routerLink="/auth/login" class="auth-link">
              <mat-icon>arrow_back</mat-icon>
              Back to Sign In
            </a>
          </div>
        </div>
        } @else {
        <form
          [formGroup]="forgotForm"
          (ngSubmit)="onSubmit()"
          class="auth-form"
        >
          <!-- Email field -->
          <div
            class="auth-form-field"
            [class.has-error]="
              forgotForm.get('email')?.invalid &&
              forgotForm.get('email')?.touched
            "
          >
            <label class="field-label" for="email">Email Address</label>
            <div class="input-container">
              <mat-icon class="prefix-icon">email</mat-icon>
              <input
                id="email"
                type="email"
                formControlName="email"
                placeholder="your@email.com"
                autocomplete="email"
              />
            </div>
            @if (forgotForm.get('email')?.invalid &&
            forgotForm.get('email')?.touched) {
            <div class="field-error">
              <mat-icon class="error-icon">error</mat-icon>
              <span>
                @if (forgotForm.get('email')?.errors?.['required']) { Email is
                required } @else if (forgotForm.get('email')?.errors?.['email'])
                { Please enter a valid email address }
              </span>
            </div>
            }
          </div>

          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="auth-submit-btn"
            [class.loading]="isLoading()"
            [disabled]="forgotForm.invalid || isLoading()"
          >
            @if (isLoading()) {
            <mat-spinner diameter="20" class="spinner"></mat-spinner>
            Sending reset link... } @else { Send Reset Link }
          </button>

          <div class="auth-links">
            <div class="forgot-help-text">
              <mat-icon class="help-icon">info_outline</mat-icon>
              <span>
                Remember your password?
                <a routerLink="/auth/login" class="auth-link"
                  >Sign in instead</a
                >
              </span>
            </div>
          </div>
        </form>
        }
      </mat-card-content>

      @if (!emailSent()) {
      <mat-card-actions class="auth-actions">
        <p class="auth-prompt">
          Don't have an account?
          <a routerLink="/auth/register" class="auth-prompt-link"
            >Sign up here</a
          >
        </p>
      </mat-card-actions>
      }
    </mat-card>
  </div>
</div>
