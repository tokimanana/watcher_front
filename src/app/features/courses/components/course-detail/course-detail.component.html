<div class="course-detail-container">
  @if (loading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p class="text-secondary">Loading course details...</p>
  </div>
  }

  @if (error() && !loading()) {
  <div class="error-container">
    <div class="alert alert-error">
      <mat-icon>error</mat-icon>
      <span>{{ error() }}</span>
    </div>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Courses
    </button>
  </div>
  }

  @if (course() && !loading() && !error()) {
  <div class="breadcrumb">
    <a routerLink="/courses" class="breadcrumb-link">
      <mat-icon>keyboard_arrow_left</mat-icon>
      Back to Courses
    </a>
  </div>

  <div class="course-header">
    <div class="course-header-content">
      <app-platform-badge
        [platform]="course()!.platform"
        size="large"
      ></app-platform-badge>

      <h1 class="course-title">{{ course()!.title }}</h1>

      <div class="course-meta-badges">
        <div class="badge-item">
          <mat-icon>schedule</mat-icon>
          <span>{{ formatDuration(course()!.contentDuration) }}</span>
        </div>

        <div class="badge-item">
          <mat-icon>signal_cellular_alt</mat-icon>
          <span>{{ course()!.level }}</span>
        </div>

        <div class="badge-item" [class.free]="!course()!.isPaid">
          <mat-icon>{{
            course()!.isPaid ? "attach_money" : "money_off"
          }}</mat-icon>
          <span>{{ formatPrice(course()!.price, course()!.isPaid) }}</span>
        </div>

        <div class="badge-item">
          <mat-icon>people</mat-icon>
          <span>{{ formatNumber(course()!.numSubscribers) }} students</span>
        </div>

        <div class="badge-item">
          <mat-icon>star</mat-icon>
          <span>{{ formatNumber(course()!.numReviews) }} reviews</span>
        </div>
      </div>

      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="goToCourse()">
          <mat-icon>launch</mat-icon>
          Go to Course on Udemy
        </button>
      </div>
    </div>

    <div class="course-image-container">
      <img
        [src]="course()!.imageUrl"
        [alt]="course()!.title"
        class="course-image"
      />
      <div class="published-date">
        Published: {{ formatDate(course()!.publishedTimestamp) }}
      </div>
    </div>
  </div>

  <div class="course-details-section">
    <div class="details-card">
      <h2>Course Information</h2>

      <div class="detail-row">
        <span class="detail-label">Platform:</span>
        <span class="detail-value">Udemy</span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Level:</span>
        <app-difficulty-badge
          [level]="getLevelBadgeClass(course()!.level)"
        ></app-difficulty-badge>
      </div>

      <div class="detail-row">
        <span class="detail-label">Duration:</span>
        <span class="detail-value">{{
          formatDuration(course()!.contentDuration)
        }}</span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Number of Lectures:</span>
        <span class="detail-value">{{ course()!.numLectures }}</span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Total Students:</span>
        <span class="detail-value">{{
          formatNumber(course()!.numSubscribers)
        }}</span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Reviews:</span>
        <span class="detail-value">{{
          formatNumber(course()!.numReviews)
        }}</span>
      </div>

      @if (course()!.technologies && course()!.technologies.length > 0) {
      <div class="detail-row">
        <span class="detail-label">Technologies:</span>
        <div class="tech-tags">
          @for (tech of course()!.technologies; track tech) {
          <span class="tech-tag">{{ tech }}</span>
          }
        </div>
      </div>
      }
    </div>

    <div class="details-card reviews-placeholder">
      <h2>Reviews</h2>
      <div class="placeholder-content">
        <mat-icon>rate_review</mat-icon>
        <p>Review system coming soon!</p>
        <small
          >Check back later to see what students think about this course.</small
        >
      </div>
    </div>
  </div>
  }
</div>
